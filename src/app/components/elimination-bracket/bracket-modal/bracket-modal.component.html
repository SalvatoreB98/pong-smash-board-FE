<div class="bracket-container" #bracketContainer (mousedown)="onDragStart($event)" (mouseup)="onDragEnd()"
    (mouseleave)="onDragEnd()" (mousemove)="onDragMove($event)" (wheel)="onWheel($event)"
    (touchstart)="onDragStart($event)" (touchmove)="onDragMove($event)" (touchend)="onDragEnd()">

    <!-- ZOOM CONTROLS -->
    <div class="bracket-controls">
        <button (click)="zoomOut()">âˆ’</button>
        <span>{{ zoomLevel | number: '1.0-1' }}x</span>
        <button (click)="zoomIn()">+</button>
    </div>

    <!-- TITLE -->
    <h2 class="text-center" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%);">
        {{ competitionName }}
    </h2>

    <!-- GRID WRAPPER -->
    <div class="bracket-grid-wrapper">

        <!-- ðŸ”¸ CONTENITORE PER LE LINEE (aggiunto) -->
        <div class="bracket-lines" #bracketLines></div>

        <div class="bracket-scale" #bracketScale>
            <div class="bracket-grid" #bracketGrid>

                <ng-container *ngFor="let round of rounds; let col = index">
                    <ng-container *ngFor="let match of round.matches; let i = index">
                        <div class="match" [ngClass]="getMatchClasses(col, i, round.matches.length)"
                            [style.gridColumn]="getGridColumn(col, i, round.matches.length)"
                            [style.gridRow]="getGridRow(col, i)">
                            <span *ngIf="shouldShowLeftConnector(col, i, round.matches.length)" class="hor hor--left"></span>
                            <span *ngIf="shouldShowRightConnector(col, i, round.matches.length)" class="hor hor--right"></span>
                            <div class="player">
                                <img [src]="match.slots[0]?.player?.image_url || 'default-player.jpg'" alt="" />
                                <span>{{ match.slots[0]?.player?.nickname || 'TBD' }}</span>
                                <strong *ngIf="match.player1Score !== null">{{ match.player1Score }}</strong>
                            </div>

                            <div class="player">
                                <img [src]="match.slots[1]?.player?.image_url || 'default-player.jpg'" alt="" />
                                <span>{{ match.slots[1]?.player?.nickname || 'TBD' }}</span>
                                <strong *ngIf="match.player2Score !== null">{{ match.player2Score }}</strong>
                            </div>
                            <span *ngIf="shouldShowLeftConnector(col, i, round.matches.length)" class="ver ver--left"
                                data-direction="left">
                                <div class="container-hor container-hor--left">
                                    <div class="hor-2"></div>
                                    <div class="hor-3"></div>
                                </div>
                            </span>
                            <span *ngIf="shouldShowRightConnector(col, i, round.matches.length)" class="ver ver--right"
                                data-direction="right">
                                <div class="container-hor container-hor--right">
                                    <div class="hor-2"></div>
                                    <div class="hor-3"></div>
                                </div>
                            </span>
                        </div>
                    </ng-container>
                </ng-container>

            </div>
        </div>
    </div>
</div>