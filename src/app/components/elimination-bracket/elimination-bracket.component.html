<section class="elimination-wrapper" *ngIf="competition as active">
  <header class="elimination-header">
    <div>
      <h2>{{ active.name }}</h2>
      <p class="text-center">{{ 'elimination_mode_description' | translate }}</p>
    </div>
    <div class="meta">
      <div class="meta-item">
        <span class="label">{{ 'best_of' | translate }}</span>
        <span class="value">{{ active['sets_type'] }}</span>
      </div>
      <div class="meta-item">
        <span class="label">{{ 'points_number' | translate }}</span>
        <span class="value">{{ active['points_type'] }}</span>
      </div>
    </div>
  </header>

  <div class="bracket" *ngIf="rounds.length; else emptyBracket">
    <div class="bracket-round" *ngFor="let round of rounds; trackBy: trackByRound">
      <h3>{{ round.name | translate }}</h3>
      <div class="bracket-matches">
        <article class="bracket-match" *ngFor="let match of round.matches; trackBy: trackByMatch">
          <div class="slot" *ngFor="let slot of match.slots; let slotIndex = index"
            [class.winner]="isSlotWinner(slot, match.winnerId)">
            <span class="seed">#{{ slot.seed }}</span>
            <img class="avatar" src="{{ slot.player?.image_url || 'default-player.jpg' }}" alt="">
            <span class="player" *ngIf="slot.player; else waiting">
              {{ slot.player.nickname || slot.player.name }}
            </span>
            <span class="score"
              *ngIf="slot.player && (slotIndex === 0 ? match.player1Score !== undefined && match.player1Score !== null : match.player2Score !== undefined && match.player2Score !== null)">
              {{ slotIndex === 0 ? match.player1Score : match.player2Score }}
            </span>
            <ng-template #waiting>
              <span class="player waiting">{{ 'elimination_waiting_player' | translate }}</span>
            </ng-template>
          </div>

          <div class="bracket-match-actions">
            <button type="button" *ngIf="match.winnerId === null"
              (click)="openModal('ADD_MATCH', { player1: match.slots[0].player, player2: match.slots[1].player })">
              {{ 'add_match' | translate }}
              <span class="m-1"></span>
              <i class="fa fa-file-text-o" aria-hidden="true"></i>
            </button>
            <button type="button" class="bg-secondary position-relative" *ngIf="match.winnerId === null"
              (click)="openModal('MANUAL_POINTS', { player1: match.slots[0].player, player2: match.slots[1].player })">
              {{ 'add_manual_set_points' | translate }}
              <div class="circle-live"></div>
            </button>
            <div class="d-flex justify-content-center">
              <button type="button" class="other ps-2 pe-2"
                *ngIf="match.matchData"
                (click)="openModal('SHOW_MATCH', { match: match.matchData, roundName: match.roundKey ?? round.name, roundLabel: match.roundLabel })">
                {{ 'view_details' | translate }}
                <i class="fa fa-info-circle ms-2" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </article>
      </div>
    </div>
  </div>

  <footer class="elimination-footer">
    <i class="fa-solid fa-hammer"></i>
    <span>{{ 'elimination_mode_work_in_progress' | translate }}</span>
  </footer>
</section>

<ng-template #emptyBracket>
  <div class="empty-bracket">
    <p>{{ 'elimination_not_enough_players' | translate }}</p>
  </div>
</ng-template>