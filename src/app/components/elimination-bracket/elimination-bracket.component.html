<div class="wrapper">
  <section class="elimination-wrapper" *ngIf="competition as active">
    <header class="elimination-header">
      <div>
        <h2>{{ active.name }}</h2>
        <p class="text-center">{{ 'elimination_mode_description' | translate }}</p>
      </div>
      <div class="meta">
        <div class="meta-item">
          <span class="label">{{ 'best_of' | translate }}</span>
          <span class="value">{{ active['sets_type'] }}</span>
        </div>
        <div class="meta-item">
          <span class="label">{{ 'points_number' | translate }}</span>
          <span class="value">{{ active['points_type'] }}</span>
        </div>
      </div>
    </header>
    <button type="button" class="elimination-back-button tertiary"
      (click)="modalService.openModal(modalService.MODALS['BRACKETS'])">
      <span>{{ 'visualize' | translate }}</span>
      <img src="bracket.png" class="ms-2 me-2" alt="bracket icon" width="75px" />
      <span>{{ 'view_bracket' | translate }}</span>
    </button>
    <div class="bracket" *ngIf="rounds.length; else emptyBracket">
      <div class="bracket-round" *ngFor="let round of rounds; let i = index; trackBy: trackByRound">
        <h3>{{ (round.stage ?? round.name) | translate }}</h3>

        <div class="bracket-matches">
          <!-- Shared match-card renders both admin and read-only bracket slots -->
          <app-match-card *ngFor="let match of round.matches; trackBy: trackByMatch" variant="bracket"
            [cardId]="match.id" [readonly]="readonly" [players]="buildBracketPlayers(match, i)"
            [bracketDate]="match?.matchData?.created" [bracketDateFallback]="'date_to_be_determined' | translate"
            [setDateAction]="buildSetDateAction(match)" [actions]="buildBracketActions(match, round)"></app-match-card>
        </div>
      </div>
    </div>

    <footer class="elimination-footer">
      <i class="fa-solid fa-hammer"></i>
      <span>{{ 'elimination_mode_work_in_progress' | translate }}</span>
    </footer>
  </section>
</div>

<app-modal [fullscreen]="true" [label]="'brackets'" *ngIf="modalService.isActiveModal(modalService.MODALS['BRACKETS'])"
  [modalName]="modalService.MODALS['brackets']" class="manual-points-modal">
  <app-bracket-modal [rounds]="rounds"></app-bracket-modal>
</app-modal>

<ng-template #emptyBracket>
  <div class="empty-bracket">
    <p>{{ 'elimination_not_enough_players' | translate }}</p>
  </div>
</ng-template>